{% extends "logic/question_base.html" %}
{% load index %}
{% load staticfiles %}

{% block question_text %}{% if question.is_formula %}נתונה הנוסחה:{% elif question.is_set %}נתונה הקבוצה:{% else %}נתון הטיעון:{% endif %}<p class="text-center formal formal-dsp">{{question.display}}</p>
<p>יש למלא את הטבלה ולבחור את האפשרות הנכונה.</p>
{% endblock %}
{% block question_instruction %}טבלת אמת{% endblock %}
{% block hint %}
יש למלא את הטבלה על ידי לחיצה על הערכים הנכונים. ניתן לנקות עמודה באמצעות הכפתורים מטה.
{% endblock hint %}
{% block hint_link %}הסבר נוסף{% endblock %}

{% block question_content %}
<script src="{% static 'logic/js/formula.js'%}"></script>
<script src="{% static 'logic/js/values.js'%}"></script>

<div dir="ltr">
  <table id="values" class="noselect" style="margin: 0px auto;">
    <tr>
      {% for c in question.display %}
      {% if c != ' '%}
      <td class="formal formal-dsp" style="padding: 0 12px 0 12px; font-size: 300%;" {% if c != ',' %}onclick="add({{forloop.counter}});{% endif %}">{{c}}</td>
      {% endif %}
      {% endfor %}
    </tr>
  </table>
    <button class="btn btn-default dd-btn" id="rem" onclick="removeLast();"><span class="glyphicon glyphicon-trash trash"></span></button>
</div>

<script>
var cols = [
{% for c in question.display %}{% if c != ' ' and c != ',' %}{{forloop.counter}},{% endif %}{% endfor %}
];
var v = new Values('{{question.formula}}', cols);

function add(i) {
    if (!v.select(i)) return;
    var rownum = v.row;
    var id = 'x'+rownum+'i'+i;
    var tfHtml = "" +
'<div class="btn-group" role="group">'+
  '<label class="label label-default" style="opacity: 0.7; margin: -1px; display: inline; font-size: 90%;" id="t'+id+'" onclick="select(\'t\', \''+id+'\')">T</label>'+
  '<label class="label" style="display: none; color: #333; font-size: 120%;" id="ans'+id+'" onclick="unselect(\''+id+'\')"></label>'+
  '<label class="label label-default" style="opacity: 0.7; margin: -1px; display: inline; font-size: 90%;" id="f'+id+'" onclick="select(\'f\', \''+id+'\')">F</label>'+
'</div>'

    var lineHtml = '<span class="verticalLine">&nbsp</span>';

    // add a new row to the table
    $('#values tr:last').after(
        '<tr id="rx'+rownum+'">'+
          {% for c in question.display %}
          {% if c != ' '%}
          '<td style="text-align: center;">'+({{forloop.counter}} == i? tfHtml : '<span id="dx'+rownum+'i'+{{forloop.counter}}+'">&nbsp</span>')+'</td>'+
          {% endif %}
          {% endfor %}
        '</tr>'
    );

    // add vertical line to above cells in column
    $("span[id$='i"+i+"']").addClass('verticalLine');
}

function removeLast() {
    $('#rx'+v.row).remove();
    var i = v.unselect();
    // remove vertical line to above cells in column
    $("span[id$='i"+i+"']").removeClass('verticalLine');
}

</script>

    <script>
    function select(type, i) {
        var clicked = '#'+type+i;
        var a = '#ans'+i;
        if (type == 't') {
            var other = '#f'+i;
        } else {
            var other = '#t'+i;
        }
        $(clicked).hide();
        $(other).hide();
        $(a).show();
        $(a).text($(clicked).text());
    }
    function unselect(i) {
        $('#t'+i).show();
        $('#f'+i).show();
        $('#ans'+i).hide();
    }
    function unselectall(i) {
        {% for row in truth_table.values %}
        unselect('{{forloop.counter}}'+i);
        {% endfor %}
    }
    </script>

  <div class="page-header" style="margin-top: 2px; margin-bottom: 2px;">
  </div>
  <div>
    <p style="font-weight: bold;">{% if question.is_formula %}הנוסחה היא:{% elif question.is_set %}הקבוצה:{% else %}הטיעון:{% endif %}</p>
    <form id=options>
    {% for option in options %}
        <input name="option" value="{{option.num}}" type="radio" {% if answer and option.num == answer_option %}checked{% endif %}> {{option.desc}}<br>
    {% endfor %}
    </form>
  </div>

  <script>
    function isEmpty() {
        if (!$('input[name=option]:checked', '#options').val())
            return 'לא נבחרה תשובה';
      {% for formula in formulas %} 
        {% for row in truth_table.values %}
        if ($('label[id=ans{{forloop.counter}}{{forloop.parentloop.counter}}]').css('display') == 'none')
            return 'הטבלה אינה מלאה';
        {% endfor %}
      {% endfor %}
    }
    function getPostData() {
        return {
            'option':$('input[name=option]:checked', '#options').val(),
            'values':[
              {% for formula in formulas %} 
                [
                {% for row in truth_table.values %}
                  $('#ans{{forloop.counter}}{{forloop.parentloop.counter}}').text(),
                {% endfor %}
                ],
              {% endfor %}
            ]
        };
    }
  </script>

{% endblock question_content %} 
