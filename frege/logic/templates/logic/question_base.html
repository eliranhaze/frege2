{% extends "logic/chapter_base.html" %}
{% block title %}שאלה {{question.number }} פרק {{ chapter.number }}{% endblock %}
{% block topic_header %}שאלה {{ question.number }}{% if followup %}: המשך{% endif %}{% endblock %}
{% block help_url %}{% url 'logic:topic-help' 1 %}{% endblock help_url%}

{% block chapter_content %}
<div class="panel panel-default">
  <div class="panel-body">
    <p class="text-muted hint">{% if ans_time %}ענית על שאלה זו ב-{{ans_time}}{% endif %}</p>
    <p class="text-muted hint">{% if question.has_followup %}לשאלה זו יש המשך{% endif %}</p>
    <p style="white-space: pre-wrap; font-size: 110%;">{% block question_text %}{% endblock %}</p>
    <div class="page-header" style="margin-top: -18px;"></div>
    <p class="noselect"><b>{% block question_instruction %}{% endblock %}</b></p>
    <p class="small text-muted">{% block hint %}{% endblock %}<a class="text-muted" href="{% url 'logic:topic-help' 1 %}" target="_blank"><u>{% block hint_link %}{% endblock %}</u></a></p>
    {% block question_content %}
    {% endblock %}
    <div class="noselect" style="padding: 5px;margin-top: 20px;">
      {% if followup %}<a href='{% url 'logic:question' chapter.number question.number %}' class="btn btn-default silent btn-lg">חזרה</a>{% endif %}
      <button class="btn btn-default btn-lg" id="answer">אישור</button>
      <button class="btn btn-default {% if question.has_followup %}silent{% else %}answered{% endif %} btn-lg" {% if answer and question.has_followup %}onclick="location.href='{% url 'logic:followup' chapter.number question.number %}';"{% else %}style="display: none;"{% endif %} id="next">{% if question.has_followup %}המשך{% else %}שאלה הבאה{% endif %}</button>
      <button class="btn btn-primary btn-lg" style="display: {% if can_submit %}inline{% else %}none{% endif %};" id="sum" data-toggle="modal" data-target="#chp-sbmt">סיום פרק</button>
    </div>
  </div>
</div>
<script>
  function reg() {
      $('#answer').one('click', function() {
          {% if followup %}
          ans('{% url 'logic:followup' chapter.number question.number %}', '{{ csrf_token }}');
          {% else %}
          ans('{% url 'logic:question' chapter.number question.number %}', '{{ csrf_token }}');
          {% endif %}
      });
  }
  $(document).ready(reg);
</script>

{% if remaining %}
<div class="modal fade" data-keyboard="false" data-backdrop="static" style="vertical-align: middle;" id="chp-sbmt" tabindex="-1" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">סיום פרק</h3>
      </div>
      <div class="modal-body" style="font-size: 105%;">
        <p>פעולה זו שולחת את הפרק להגשה ומיד לאחריה יהיה ניתן לראות את הציון. נותרו לך <b>{{remaining}} נסיונות</b> הגשה.</p>
        <p>האם ברצונך לסיים את הפרק?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-lg" data-dismiss="modal">לא עכשיו</button>
        <button type="button" class="btn btn-primary btn-lg btn-ok">כן</button>
      </div>
    </div>
  </div>
</div>
<script>
$(document).ready(function() {
    $('#chp-sbmt').on('click', '.btn-ok', function(e) {
        $(e.delegateTarget).addClass('loading');
        sbt('{% url 'logic:chapter-summary' chapter.number %}', '{{ csrf_token }}');
    });
});
</script>
{% endif %}

  <div class="page-header"></div>
  <div class="panel panel-default">
    <div class="panel-body noselect">
{% for qnum, status in chap_questions.iteritems %}
  {% if question and qnum == question.number %}
      <button class="btn btn-primary btn-q">{{ qnum }}</button>
  {% else %}
      <a href='{% url 'logic:question' chapter.number qnum %}' class="btn btn-default btn-q {% if status == 'half' %}silent{% elif status %}answered{% endif %}">{{ qnum }}</a>
  {% endif %}
{% endfor %}
    </div>
  </div>
{% endblock chapter_content %}
