function Formula(t){this.c=null,this.s1=null,this.s2=null,this.lit=n(t),this.an(this.lit)}function t(t){return t.toLowerCase()!=t.toUpperCase()}function i(t){return t==o||t==h||t==u||t==c}function r(t){return t==o||t==h||t==c}function n(t){return s(t).replace(/ /g,"")}function s(t){if("("==t.charAt(0)&&")"==t.charAt(t.length-1))for(var i=0,r=0;r<t.length;r++){var n=t.charAt(r);if(")"==n){if(i--,0==i)return r==t.length-1?s(t.slice(1,t.length-1)):t}else"("==n&&i++}return t}var e="~",o="·",h="∨",u="⊃",c="≡";Formula.prototype.an=function(r){if(!this.ia()){for(var n="נוסחה לא תקינה",s=!1,f=0,o=0;o<r.length;o++){var h=r.charAt(o);if(")"==h)f--;else if("("==h){if(f++,o+1<r.length){var u=r.charAt(o+1);if(!t(u)&&u!=e&&"("!=u)throw new Error(n)}}else if(0==f){if(i(h)){var c=r.slice(0,o),l=r.slice(o+1);if(this.c=h,this.s1=new Formula(c),this.s2=new Formula(l),!this.s1.vs(c)||!this.s2.vs(l))throw new Error(n);return}h==e&&(s=!0)}else if(f<0)throw new Error("סוגריים לא מאוזנים")}if(0!==f)throw new Error("סוגריים לא מאוזנים");if(s){var a=r.slice(1);if(r.charAt(0)!==e)throw new Error(n);return this.c=e,void(this.s1=new Formula(a))}throw new Error(n)}},Formula.prototype.ia=function(){return 1==this.lit.length&&t(this.lit)},Formula.prototype.icn=function(){return this.c==o&&(this.s1.ing(this.s2)||this.s2.ing(this.s1))},Formula.prototype.ing=function(t){return this.c==e&&this.s1.eq(t)},Formula.prototype.eq=function(t){if(!t)return!1;if(this.lit==t.lit)return!0;if(this.ia())return!1;if(this.c==t.c){if(!i(this.c))return this.s1.eq(t.s1);if(this.s1.eq(t.s1)&&this.s2.eq(t.s2))return!0;if(r(this.c))return this.s1.eq(t.s2)&&this.s2.eq(t.s1)}return!1},Formula.prototype.cm=function(t,r){if(i(r))return f=new Formula("p"),f.c=r,f.s1=this,f.s2=t,f.lit=this.wr()+r+t.wr(),f},Formula.prototype.ng=function(){return f=new Formula("p"),f.c=e,f.s1=this,f.lit=e+this.wr(),f},Formula.prototype.wr=function(){return i(this.c)?"("+this.lit+")":this.lit},Formula.prototype.vs=function(t){return this.ia()||!i(this.c)||t!==s(t)},Formula.prototype.toString=function(){return this.lit};
