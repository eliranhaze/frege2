function n(){kn=[],mn=[],mn[0]=0,xn=null}function t(){return kn.length}function r(){return parseInt(kn[kn.length-1])}function i(){M(),xn=parseInt(kn.pop()),c()}function e(){kn.push(parseInt(z())),c()}function c(){mn[z()]=t()}function f(n){return kn.length>0&&parseInt(n)>=kn[0]}function u(n){var r=t();return r===o(n)&&(0===r||f(n))}function o(n){n=parseInt(n);var t=0;for(line in mn)line=parseInt(line),line>t&&line<=n&&(t=line);return mn[t]}function s(n,t){var r=T(n),i=T(t),e=a(r,i);return e?e:a(i,r)}function a(n,t){if(n.con===pn&&q(n.sf1,t.lit))return L(n.sf2)}function l(n){var t=T(n);if(t.con===vn)return[L(t.sf1),L(t.sf2)]}function h(n,t,r){var i=T(n),e=T(t),c=T(r);return i.con===$n&&e.con===pn&&c.con===pn?d(i,e,c):e.con===$n&&i.con===pn&&c.con===pn?d(e,i,c):c.con===$n&&e.con===pn&&i.con===pn?d(c,e,i):void 0}function d(n,t,r){if(q(t.sf2,r.sf2)&&(q(n.sf1,t.sf1)&&q(n.sf2,r.sf1)||q(n.sf1,r.sf1)&&q(n.sf2,t.sf1)))return L(t.sf2)}function v(n){var t=T(n);if(t.con===gn)return[t.sf1+pn+t.sf2,t.sf2+pn+t.sf1]}function p(n){var t=T(n);if(t.con===dn){var r=T(t.sf1);if(r.con===dn)return L(r.sf1)}}function g(){if(t()>0){var n=fn([r(),_()]);return i(),Q(n[0])+pn+Q(n[1])}}function k(n,t){return Q(n)+vn+Q(t)}function m(n,t){return Q(n)+$n+Q(t)}function x(n,t){var r=T(n),i=T(t);if(r.con===pn&&i.con===pn&&r.sf1===i.sf2&&r.sf2===i.sf1)return r.sf1+gn+i.sf2}function y(){if(t()>0){var n=fn([r(),_()]);if(w(n[1]))return i(),dn+Q(n[0])}}function b(n){return e(),n}function C(n){return n}function I(n){var t={valid:!1,lit:"",err:""},r=j(n);if(E(r))t.valid=!0,t.lit=r;else{var i=T(r);""==i.con?(t.valid=!1,t.err=i.err):(t.valid=!0,t.lit=i.lit)}return t}function A(n){return E(n)||!K(T(n).con)||n!==L(n)}function E(n){return 1===n.length&&n===n.toLowerCase()&&n.toLowerCase()!==n.toUpperCase()}function w(n){var t=T(n);if(t.con===vn){var r=T(t.sf1),i=T(t.sf2);return S(r,i)||S(i,r)}return!1}function S(n,t){return n.con===dn&&q(n.sf1,t.lit)}function q(n,t){var r=T(n),i=T(t);if(r.lit===i.lit)return!0;if(E(n))return!1;if(r.con===i.con){if(q(r.sf1,i.sf1)&&q(r.sf2,i.sf2))return!0;if(O(r.con))return q(r.sf1,i.sf2)&&q(r.sf2,i.sf1)}return!1}function T(n){var t=j(n),r={lit:t,con:"",sf1:"",sf2:""};if(E(t))return r;for(var i="נוסחה לא תקינה",e=!1,c=0,f=0;f<t.length;f++){var u=t.charAt(f);if(")"===u)c--;else if("("===u){if(c++,f+1<t.length){var o=t.charAt(f+1);if(!E(o)&&o!==dn&&"("!==o)return r.err=i,r}}else if(0===c){if(K(u)){var s=t.slice(0,f),a=t.slice(f+1);return A(s)&&A(a)&&I(s).valid&&I(a).valid?(r.con=u,r.sf1=s,r.sf2=a,r):(r.err=i,r)}u===dn&&(e=!0)}else if(c<0)return r.err="סוגריים לא מאוזנים",r}if(0!==c)return r.err="סוגריים לא מאוזנים",r;if(e){var l=t.slice(1);return t.charAt(0)===dn&&I(l).valid?(r.con=dn,r.sf1=l,r):(r.err=i,r)}return r.err=i,r}function j(n){return L(n).replace(/ /g,"")}function L(n){if("("===n.charAt(0)&&")"===n.charAt(n.length-1))for(var t=0,r=0;r<n.length;r++){var i=n.charAt(r);if(")"===i){if(t--,0===t)return r===n.length-1?L(n.slice(1,n.length-1)):n}else"("===i&&t++}return n}function K(n){return n===vn||n===$n||n===pn||n===gn}function O(n){return n===vn||n===$n||n===gn}function Q(n){return n.length>1&&T(n).con!=dn?"("+n+")":n}function R(n,t,r,i,e,c){yn=null,e?n.text()===bn?U(t,r,i,e,c)&&an(n):(an(n),D(r)&&(sn(n),yn=n)):U(t,r,i,e,c),n.blur()}function U(n,t,r,i,e){if(D(t,e)){var c=un(),f=fn(c);if(i){var u=ln();if(!u)return on("יש להזין נוסחה");var o=I(u);if(!o.valid)return on(o.err);f.push(o.lit)}var s=n.apply(this,f);if(s){var a=z(),l=r(c);s instanceof Array||(s=[s]);for(var h=0;h<s.length;h++)G(a+h,s[h],l);return B(),$.notifyClose(),!0}return on(t>0?"לא ניתן להשתמש בכלל זה עבור השורות שנבחרו":"לא ניתן להשתמש בכלל זה במצב הנוכחי")}}function _(){return $("#deduction >tbody >tr").length}function z(){return _()+1}function B(){$("input[type=checkbox]").prop("checked",!1)}function D(n,t){if(n>0){var r=un();if(r.length!=n){var i=["","שורה אחת","שתי שורות","שלוש שורות"];return on("יש לבחור "+i[n]+" בדיוק על מנת להשתמש בכלל זה"),!1}if(t)return F(r);for(var e=0;e<r.length;e++)if(!u(r[e]))return on("שורה "+r[e]+" מחוץ לרמה הנוכחית"),!1}else B();return!0}function F(n){var t=n[0];return u(t)?(on("שורה "+t+" כבר נמצאת ברמה הנוכחית"),!1):!(o(t)>0&&!f(t))||(on("שורה "+t+" נמצאת בתת הוכחה אחרת"),!1)}function G(n,r,i){for(var e=0;e<t();e++)r=J(r,n,t()-e);$("#deduction tr:last").after('<tr id="row'+n+'"><td class="dd-num""><input type="checkbox" id="cb'+n+'" name="'+n+'" onclick="oncheck()">'+n+'. </input></td><td id="f'+n+'">'+r+'</td><td class="dd-just">'+i+"</td></tr>")}function H(){B(),$("#row"+_()).remove()}function J(n,t,r){return'<div class="dd-hyp" id="nst'+t+r+'">'+n+"</div>"}function M(){$("#nst"+_()+t()).addClass("dd-hyp-end")}function N(n){return"E ⊃ "+n[0]+","+n[1]}function P(n){return"E · "+n[0]}function V(n){return"E ∨ "+n[0]+","+n[1]+","+n[2]}function W(n){return"E ≡ "+n[0]}function X(n){return"E ~ "+n[0]}function Y(){return"I ⊃ "+xn+"-"+_()}function Z(n){return"I · "+n[0]+","+n[1]}function nn(n){return"I ∨ "+n[0]}function tn(n){return"I ≡ "+n[0]+","+n[1]}function rn(){return"I ~ "+xn+"-"+_()}function en(){return"hyp"}function cn(n){return"rep "+n[0]}function fn(n){for(var t=[],r=0;r<n.length;r++)t.push($("#f"+n[r]).text());return t}function un(){return $("input:checkbox:checked").map(function(){return this.name}).get()}function on(n){$.notify({message:n},{allow_dismiss:!0,delay:1400,template:'<div data-notify="container" class="col-xs-11 col-sm-3 alert text-center note" role="alert"><span data-notify="dismiss"><span data-notify="message">{2}</span></span></div>'})}function sn(n){$("#extra").css("opacity","1"),setTimeout(function(){$("#extxt").focus()},5),$("#extxt").on("input",function(){n.data("symbol")||n.data("symbol",n.text()),n.removeClass("btn-default"),n.addClass("btn-primary"),n.text(bn)}),$(document).keypress(function(t){13==t.which&&n.click()})}function an(n){$("#extra").css("opacity","0"),$("#extxt").val(""),$("#extxt").off("input"),$(document).off("keypress"),n&&(n.addClass("btn-default"),n.removeClass("btn-primary"),n.text(n.data("symbol")))}function ln(){return $("#extxt").val()}function oncheck(){an(yn)}function hn(n){$("#extxt").insertAtCaret(n),$("#extxt").focus()}var dn="~",vn="·",$n="∨",pn="⊃",gn="≡",kn=[],mn=[],xn=null;n();var yn=null,bn="OK";jQuery.fn.extend({insertAtCaret:function(n){return this.each(function(t){if(document.selection){this.focus();var r=document.selection.createRange();r.text=n,this.focus()}else if(this.selectionStart||"0"==this.selectionStart){var i=this.selectionStart,e=this.selectionEnd,c=this.scrollTop;this.value=this.value.substring(0,i)+n+this.value.substring(e,this.value.length),this.focus(),this.selectionStart=i+n.length,this.selectionEnd=i+n.length,this.scrollTop=c}else this.value+=n,this.focus()})}}),$(document).ready(function(){$("#imp-e").click(function(){R($(this),s,2,N)}),$("#con-e").click(function(){R($(this),l,1,P)}),$("#dis-e").click(function(){R($(this),h,3,V)}),$("#eqv-e").click(function(){R($(this),v,1,W)}),$("#neg-e").click(function(){R($(this),p,1,X)}),$("#imp-i").click(function(){R($(this),g,0,Y)}),$("#con-i").click(function(){R($(this),k,2,Z)}),$("#dis-i").click(function(){R($(this),m,1,nn,!0)}),$("#eqv-i").click(function(){R($(this),x,2,tn)}),$("#neg-i").click(function(){R($(this),y,0,rn)}),$("#hyp").click(function(){R($(this),b,0,en,!0)}),$("#rep").click(function(){R($(this),C,1,cn,!1,!0)}),$("#rem").click(function(){H(),$(this).blur()}),$("#neg").click(function(){hn("~")}),$("#con").click(function(){hn("·")}),$("#dis").click(function(){hn("∨")}),$("#imp").click(function(){hn("⊃")}),$("#eqv").click(function(){hn("≡")})});
